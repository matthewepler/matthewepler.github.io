---
layout: post
title:  "Multiscreen Video with PiWall"
date:   2016-01-05 12:00:00 -0500
categories: raspi
summary: "One video. Multiple screens. Raspberry Pi."
---
## Summary
This tutorial will walk you through the setup of a video wall installation. It features just three screens but it can easily be scaled to as many screens as you wish. 

These instructions use the [PiWall][piwall-home] software and can be used as an alternative to their [configuration][piwall-config] and [installation][piwall-install] instructions, which were a bit confusing to me.

Each screen requires its own RPi, and the system also requires an additional "Master" Pi as well as additional hardware listed below.

### OSX / Windows
I am using a Mac in this tutorial. This will aboslutely still work with windows, but some of the Terminal commands may be different. You are probably smart enough to Google the ones that don't work for you. Probably.

### Note on PiWall
There are many different ways to set up a PiWall. This is just one of them. You may disagree with how I've dont it but, hey it's my blog. So there. I'm just passing on what worked for me. I hope it helps someone somewhere someday somehow.

***

## Materials
* Raspberry Pi's (1 per screen + 1 master)
* For each Pi:
  * SD card
  * Power supply
  * Ethernet cable
* Screens + power supplies
* HDMI cables (one for each screen)
* Ethernet switch ([example][switch])
* Wireless router ([example][router])
* Power strip or equivalent power source

Why the wireless router? Well in our case we are going to have 4 Pi's and they're all going to be connected using ethernet cables. If we add USB wifi antennas to that, it can confuse the OS as to which one it should assign an IP address. The best possible scenario is to have a single WiFi access point that allows me to communicate to all the Pi's easily. The wireless router allows me to do that. I realize this is an added expense, but I found it to be well worth it and I've begun using the device on the other projects too. 

As an alternative, you could put a USB WiFi dongle in each Pi, and set the network configuration for each to join your wireless network. For info on how to do that, go [here][pi-wifi]. I will not be discussing that kind of setup within this tutorial, however. Sorry. Kinda. Not really.

***

## Raspberry Pi Setup
PiWall works as a master/slave system. one Pi, the master, will have the video file and send it out to all the slaves. each slave is a Pi with a screen attached to it. The master has no screen.

Unless otherwise noted, you will want to follow these instructions for EVERY PI IN YOUR SYSTEM.

To do the setup, you will need to access the Pi's command line. The easiest way to do this is to hook it into a monitor and keyboard. If you're super savvy, you can run it headless (Google it). If you use Pi's a lot, you may want to invest in a [LapDock][lapdock]. I use mine all the time.

If you've never set up a Raspberry Pi before, go [here][raspi-setup] to learn how to install the OS and come back!

### OS Setup
Make sure you have Raspian installed on the SD card before booting your Pi. It is recommended that you work with a fresh install to avoid conflicts with packages you already installed and configuration files you may have already changed. Wheezy and Jessie have been tested with this setup and both work. 

If you are on Wheezy, you wills ee a command line and need to login (username = pi, pswd = raspberry). If you're on Jessie, it should boot to the desktop interface. From there, open the Terminal program. on Wheezy, you're already on the command line so you're good to go.

![terminal on desktop]({{ site.url }}/images/terminal.png) 

If you want to check your keyboard layout (default is UK), run `sudo raspi-config` and use the arrow keys and Enter to go into "Internationalisation Options." If you installed your OS using N00Bs, you have the option of setting the keyboard layout via a dropdown menu at the bottom of the install screen. Finish out of the config scvreen when you're down using the right-arrow key and Enter. 

Now it's time to setup your network configuration.

### Network Setup
In the command line, run
`sudo nano /etc/network/interfaces`

Somewhere in that file you will see a linke that reads `iface eth0 inet manual`

![default interfaces file]({{ site.url }}/images/manual.jpg)

Change that line to read: `iface eth0 inet static`

Then add the following lines below that:

`address 192.168.XXX`

`netmask 255.255.255.0`

`up route add -net 224.0.0.0 netmask 240.0.0.0 eth0`

![static IP config]({{ site.url }}/images/static_IP.JPG)

What's with the XXX? You'll want to substitute XXX with a number you can remember. Each Pi will need a number (IP Address) to identify it on the network we are building. As an example, `192.168.0.10` for the first Pi (master), `192.168.0.11` for the second, and so on. The numbers should be sequential. You can use 2 digits or 3 (100, 101, etc). 

NOTE: If you are not using the WiFi router as recommended here, you will need to check your network for existing IP addresses and make sure you don't assign an IP address to a Pi that is already in use by another device. Google "scan IP leases nmap" to figure out how to do that. It will require you to install a command line tool called 'nmap.'

At this point I usually use a sticky note to keep track of the info for each device. You can ignore the "switch" info in the pic below. That's coming later.

![Pi's with sticky notes attached]({{ site.url }}/images/sticky_notes.JPG)

Save and quit by entering `ctrl + o` then Enter to agree to save the file to its original name/location. Then `ctrl + x` to exit. 

### Optional Setup
My screens require 5V, 2A of power, and I can provide that thorugh the USB ports on the RPi2 but I have to configure that setup manually. If you have a similar need, follow these steps. If not, skip to the next section.

For each Pi that will have a screen (each slave), open the boot config file by running:
`sudo nano /boot/config.txt`

Follow the instructions[here][adafruit-power] for editing that file. Save (`ctrl + o`) and exit (Enter then `ctrl + x`). Be sure to add the very last line `max_usb_current=1`

Reboot the slaves! Run `sudo reboot`.

### Finish up
Okay, that's it for the Pi's for now. If you haven't already, shutdown all the Pi's: 

`sudo shutdown -h now`

***

## WiFi Router Setup
 These instructions are for the router recommended in the Materials list. 

 Your router comes with instructions on how to open the device and install the battery. Go ahead and open up the device and put in the battery. Before you replace the cover, write down (or take a pic) the info on the label inside, just above where the battery goes.

 ![router info close up]({{ site.url }}/images/tp-info-battery.JPG)

 Set the switch on the side to WISP, plug in the device, and power up. This will put the router in a mode that effectively extends your existing wireless network.

 On your computer, look for the matching WiFi network. It should match the WiFi info from the previous step and look something like this: "TP-LINK_MR3040..." Connect to it and when asked for a password, enter the PIN from the previous step. 
 Once connected, open your browser and go to `192.168.0.1`. On the left-side menu, click "Quick Setup." Click through the menus without changing and of the defaults unless you know what you're doing (I didn't so I kept them where they are). 
 ![TP-Link setup screen]({{ site.url }}/images/tp_quicksetup.png)

 When you get to the screen that asks for information about your wireless network, click the "Survey" button to see a list of networks to choose from. Connect to yours by clicking the "Connect" link next to your network's name and then enter your password (most likely a WPA/WPA2 password). 

 Reboot the router when it prompts you and you should be back on the regular internet - only now yhou're going through the wireless router.

 Now hook up the switch to the Wireless router with an ethernet cable in the router package. It should go from the router to the #1 slot in the switch. Oh yeah - the switch. You should plug that in. Pictured is the one I recommend in the Materials list but you can use any switch.

 ![router connection to switch]({{ site.url }}/images/router_switch.JPG)

 Hook up your Pi's to the switch (write the number of the switch port on your sticky note if you'd like) and then power. Now you have a wonderful mess.

 ![Pis connected to switch]({{ site.url }}/images/beautiful_mess.JPG)

 If you haven't connected your screens yet, now is a good time to do that to make sure the Pis are booting correctly and everything has power. 

 Next we will test the connection to our Pi's. Make sure your computer is connected to the router's WiFi network and open a new terminal window for each of your Pi's. In each window, open an ssh connection by running this command:

 `ssh pi@192.168.0.XXX`

 Substitute XXX for the number in that Pi's IP address. You will be asked if you want to continue. Type `yes` and hit Enter. Then login as per normal to your Raspberry Pi. If you see something like this - you're in!

 ![ssh connection success]({{ site.url }}/images/sshx4.png)

[piwall-home]: http://www.piwall.co.uk/
[piwall-config]: http://www.piwall.co.uk/information/configuration-file
[piwall-install]: http://www.piwall.co.uk/information/installatio
[switch]: http://www.amazon.com/gp/product/B000FNFSPY?psc=1&redirect=true&ref_=oh_aui_search_detailpage 
[router]: http://www.amazon.com/gp/product/B0088PPFP4?psc=1&redirect=true&ref_=oh_aui_search_detailpage
[pi-wifi]: https://www.raspberrypi.org/documentation/configuration/wireless/
[lapdock]: https://blog.adafruit.com/2012/06/21/using-a-raspberry-pi-with-a-motorola-lapdock/
[raspi-setup]: https://www.raspberrypi.org/help/noobs-setup/
